# 后续开发计划（2026 Q1-Q2）

**项目**：LingerPerceiver（无人船靠离泊感知）  
**记录人**：________  
**更新时间**：2026-01-15  

---

## 0. 背景与目标

### 0.1 当前阶段输入

- 单雷达（Mid-360）为主，现场已完成多段 `.lgv` 数据采集。
- 雷达安装角度/位置存在不确定性，需要软件侧外参支持。
- 新需求方向：
  - 单雷达下的 U 型码头判定（几何结构推断）
  - 通用障碍物检测（为控制/规划提供结构化输出）

### 0.2 阶段目标

- **短期（1-2周）**：让现有数据“可用”，建立离线评测闭环。
- **中期（3-6周）**：实现通用障碍物检测 MVP；U 型码头检测 V1。
- **长期（6-12周）**：提升鲁棒性与工程化（标定/配置/性能/日志/指标）。

---

## 1. 基础能力（必须先做）

### 1.1 外参/姿态统一（里程碑 M1）

**目标**：无论雷达如何安装，算法都在统一的船体坐标系 B 上运行。

- 外参配置：位置 $(x,y,z)$ + 姿态 (roll/pitch/yaw)
- 点云变换：在处理链路早期统一应用 $T_{S\to B}$
- IMU 姿态：
  - 现阶段可先用于时间对齐与姿态估计
  - 后续再评估是否做去畸变/运动补偿

**验收标准**：
- 同一段 `.lgv` 回放，多次运行输出稳定
- ROI/海面滤波/边缘检测的参数含义与现实一致（Z 真的是“向上”）

### 1.2 数据集管理与回放评测（里程碑 M1）

- 数据组织：
  - 统一命名规则（场景/距离/角度/时间）
  - 元数据（天气/海况/安装角度/现场照片）
- 回放脚本：
  - 批量回放、自动导出关键指标（帧率、点数、检测状态）

**验收标准**：
- 能快速定位“哪段数据代表什么场景”
- 能用离线回放复现现场问题

---

## 2. 通用障碍物检测（MVP -> V2）

### 2.1 MVP（里程碑 M2，约1-2周）

**输出**：障碍物列表（距离、方位、粗略尺寸、置信度）。

建议 pipeline：
1. 预处理：距离滤波 + ROI + 体素下采样 + 离群点
2. 水面干扰抑制：
   - 高度/海面滤除（可配置）
   - 反射强度阈值（可选）
3. 聚类：欧式聚类/DBSCAN
4. 几何摘要：
   - AABB/OBB 尺寸
   - 最近点距离、方位角
5. 时间维度：简单跟踪（ID 维持、速度估计可选）

**验收标准**：
- 静态码头立柱/浮标能稳定成簇
- 输出在 10Hz+ 回放下实时可跑

### 2.2 V2（里程碑 M3，约2-4周）

- 增加场景鲁棒性：
  - 水面镜面反射：基于高度+密度+连通性组合抑制
  - 小目标（浮标）召回率提升
- 输出协议升级（若需要）：
  - 多目标列表（若控制端支持）
  - 或保留“最近风险目标”单输出，另带统计字段

---

## 3. 单雷达 U 型码头检测（V1 -> V2）

### 3.1 V1（里程碑 M2，同期推进）

**思路**：利用单雷达视场内的多段边缘/墙面线结构，推断“U 型”的存在与相对姿态。

建议路线：
1. 从点云中提取“墙/岸线候选”点（高度切片+ROI）
2. 多假设直线拟合（已存在类似结构）
3. 判定规则（V1）：
   - 存在两条近似平行侧墙（间距落在合理范围）
   - 或存在左右两条侧墙 + 端墙（形成 U 形）
4. 输出：
   - U 型置信度、估计槽口方向、槽宽、最近距离

**验收标准**：
- 在已采集 U 型码头数据上可稳定触发
- 对非 U 型岸线不误报（或置信度低）

### 3.2 V2（里程碑 M3-M4）

- 引入时间滤波与状态机：靠近/进入/停泊
- 引入几何一致性：槽宽稳定、角度变化连续

---

## 4. 工程化与性能（贯穿）

### 4.1 性能指标

- 输入：10Hz+（Mid-360）
- 处理：单机实时（树莓派/工控机目标平台）
- 关键统计：
  - 每帧点数、滤除点数
  - 聚类耗时、总耗时
  - 丢帧率

### 4.2 运行可观测性

- 关键日志降噪：避免刷屏但保留告警
- 运行态指标导出（CSV/JSON）：便于离线对比

### 4.3 配置管理

- 将外参、滤波、算法阈值全部配置化
- 提供“现场快速调参”模式（热加载可选）

---

## 5. 里程碑与交付物

| 里程碑 | 时间建议 | 交付物 | 验收点 |
|-------|----------|--------|--------|
| M1 基础闭环 | 1-2周 | 外参变换+回放评测脚本 | 坐标统一、离线复现稳定 |
| M2 MVP功能 | 2-4周 | 障碍物MVP + U型V1 | 主要场景可检出、10Hz可跑 |
| M3 鲁棒提升 | 4-8周 | 水面干扰抑制+多目标/稳定性 | 误报下降、稳定性提升 |
| M4 工程化 | 8-12周 | 配置/日志/指标/部署文档 | 可交付部署与持续迭代 |

---

## 6. 近期优先级（下周就做）

1. 外参配置与点云坐标统一（先让现有 `.lgv` 数据“恢复可解释”）
2. 离线回放评测闭环（批量跑、输出指标）
3. 障碍物检测 MVP：聚类 + 最近障碍物输出
4. U 型检测 V1：多线段拟合 + 几何规则判定

---

## 7. 风险与对策

- **单雷达视场不足**：通过算法接受“只能看到一部分墙”的事实，用时间/几何一致性增强判定。
- **安装外参不稳定**：提供标准化安装基座与快速标定流程；软件侧配置化。
- **水面反射误报**：组合滤波（高度/密度/连续性/时间一致性）逐步压制。

